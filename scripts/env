#!/usr/bin/env sh

REPO_ROOT=$(git rev-parse --show-toplevel)
cd "$REPO_ROOT"

SUPPORTED_ENVS="prod dev"
env_file=".env"

env_exists() {
    for env in $SUPPORTED_ENVS;
    do
        if [ "$env" = "$1" ]; then
            return 0
        fi
    done
    return 1
}

print_envs() {
    echo "This project supports the following environments:"
    for env in $SUPPORTED_ENVS;
    do
        echo "  $env"
    done
}

# handle runs with no argument provided
if [ -z "$1" ]; then
    if [ -f "$env_file" ]; then
        # print the current env name
        export $(grep -v '^#' "$env_file" | xargs)
        echo $REPO_ENV
        exit 0
    else
        echo "No environment set."
        print_envs
        exit 1
    fi
fi

# handle runs with an argument provided
new_env="$1"
if env_exists "$new_env"; then
    # echo "$new_env" > "$env_file"
    echo "Setting environment to '$new_env'."
    exit 0
else
    echo "Unknown environment '"$new_env"'."
    print_envs
    exit 1
fi
