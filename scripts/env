#!/usr/bin/env sh

. "$(dirname "$0")/utils.sh"

REPO_ROOT=$(git rev-parse --show-toplevel)
cd "$REPO_ROOT"

SUPPORTED_ENVS="prod dev"
env_file=".env"

env_exists() {
    for env in $SUPPORTED_ENVS;
    do
        if [ "$env" = "$1" ]; then
            return 0
        fi
    done
    return 1
}

print_envs() {
    echo "This project supports the following environments:"
    for env in $SUPPORTED_ENVS;
    do
        echo "  $env"
    done
}

# handle runs with no argument provided
if [ -z "$1" ]; then
    if [ -f "$env_file" ]; then
        # print the current env name
        export $(grep -v '^#' "$env_file" | xargs)
        echo $PROJECT_ENV
        exit 0
    else
        echo "No environment set."
        print_envs
        exit 1
    fi
fi

# handle runs with an argument provided
NEW_ENV="$1"
if in_array "$NEW_ENV" "$SUPPORTED_ENVS"; then
    # echo "$NEW_ENV" > "$env_file"
    echo "Setting environment to '$NEW_ENV'."
    exit 0
else
    echo "Unknown environment '"$NEW_ENV"'."
    print_envs
    exit 1
fi
